<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/css/styles.css"/>
  </head>
  <body>
    <header>
      <nav>
        <ol class="logo">
          <li>
            <a href="/">
              <img src="/media/brightdigit-name.svg"/>
            </a>
          </li>
        </ol>
        <ol class="menu">
          <li>
            <a href="/services">Services</a>
          </li>
          <li>
            <a href="/products">Products</a>
          </li>
          <li>
            <a href="/articles">Articles</a>
          </li>
          <li>
            <a href="/development">Development</a>
          </li>
        </ol>
        <ol class="menu">
          <li>
            <a href="/podcast">Podcast</a>
          </li>
          <li>
            <a href="/newsletters">Newsletters</a>
          </li>
          <li>
            <a href="/sponsorship">Sponsorship</a>
          </li>
          <li>
            <a href="/about">About</a>
          </li>
        </ol>
        <ol class="more">
          <li>
            <a href="/#menu">Menu</a>
          </li>
        </ol>
      </nav>
    </header>
    <main>
      <article>
        <div class="content"><img src="https://www.brightdigit.com/wp-content/uploads/2017/06/scriptingbridge-with-swift-communicating-with-apps-using-applescript-and-swift-300x105.png"/><p>{.alignnone .size-medium .wp-image-276 width="300" height="105"} <strong>AppleScript</strong> is a great technology on macOS for both developers and power users. It allows users to create automated processes which work other apps. As a developer though, sometimes you want a <strong>build an app in Xcode with the power of AppleScript</strong>without the need to have separate script files. To work with AppleScript in any app, there are two options to do this:</p><ol><li><strong>Write a separate AppleScript file</strong> and use the <a href="https://developer.apple.com/documentation/foundation/scripting_support"><em>NSAppleScript API</em></a> to execute and run the script.</li><li><strong>Use ScriptingBridge</strong> to work with AppleScript in <strong>Swift</strong> or <strong>Objective-C</strong>.</li></ol><p>We are going to look at the second option: ScriptBridging. In particular, how to use ScriptBridge in Swift wihout the need for AppleScript files or event Objective-C bridging.</p><h4>The Drawbacks of ScriptBridging</h4><p><strong>It should be noted if you intend to write an App for the Mac App Store there are restrictions as <a href="https://developer.apple.com/library/content/qa/qa1888/_index.html">noted by Apple</a>.</strong> You can also look at <a href="https://www.objc.io/issues/14-mac/sandbox-scripting/">this article by Craig Hockenberry</a> which shows how you can use the AppleScript API in a Mac Store app. The bottom line is: <strong>You can not use ScriptingBridge with an app in the Mac App Store.</strong></p><h4>Objective-C ScriptBridging to Swift ScriptBridging</h4><p>When it comes to <strong>Objective-C</strong> ScriptBridging, Apple already provides <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ScriptingBridgeConcepts/UsingScriptingBridge/UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_12">tools to prepare the code</a>. Luckily, <strong>Tony Ingraldi of <a href="http://majestysoftware.com/">Majesty Software</a>, has <a href="https://github.com/tingraldi/SwiftScripting">a great set of python scripts</a> for creating the same code in Swift.</strong> For more details on this specifically take a look <a href="https://github.com/tingraldi/SwiftScripting">his repo on GitHub</a> or <a href="https://majestysoftware.wordpress.com/2015/03/31/swift-scripting-part-1/">his blog post here</a>.</p><h4>ScriptBridging with Safari</h4><p>Now let's try doing this <strong>by writing <a href="https://github.com/brightdigit/jURLnal">an app which pulls the tab urls out of a Safari window</a>.</strong> The repo for this app can be found <a href="https://github.com/brightdigit/jURLnal">here</a>.</p><h5>Building the Swift Code from AppleScript Definition</h5><p>Download the python scripting tools from the <a href="https://github.com/tingraldi/SwiftScripting">SwiftScripting repo on GitHub</a>. From the repo's directory, run the following commands:</p><p>pip install clang sdef /Applications/Safari.app &gt; Safari.sdef sdp -fh --basename Safari Safari.sdef ./sbhc.py Safari.h ./sbsc.py Safari.sdef</p><p>Let's break this down:</p><ol><li><code>pip install clang</code> - ensures clang is installed for python</li><li><code>sdef /Applications/Safari.app &gt; Safari.sdef</code> - gets the scripting definition from the specified script- able application</li><li><code>sdp -fh --basename Safari Safari.sdef</code> - transforms a scripting definition to an Objective-C header file</li><li><code>./sbhc.py Safari.h</code> - transforms the Objective-C header file to Swift</li><li><code>./sbsc.py Safari.sdef</code> - extracts the enums from the standard definition to Swift</li></ol><p>Now you should have 4 new files:</p><ul><li><strong>Safari.sdef</strong> - the scripting definition file, which is used to build the code</li><li><strong>Safari.h</strong> - the objective-c header file, which we would use if we were doing objective-c directly or using objective-c bridging</li><li><strong>Safari.swift</strong> - the primary file containing the main ScriptingBridge API to the application</li><li><strong>SafariScripting.swift</strong> - the nessecary enums needed by the ScriptingBridge API for the application</li></ul><p>Since we are using only Swift code, we will only need the two Swift files (Safari.swift and SafariScripting.swift) in our application. Add the two files to your project in Xcode and now in our application we can talk to Safari.</p><h5>Using the ScriptBridging API for Safari</h5><p>To pull the all Safari windows currently open:</p><p>if let application = SBApplication(bundleIdentifier: "com.apple.Safari") { let safariApplication = application as SafariApplication let safariWindows = safariApplication.windows?().flatMap({ $0 as? SafariWindow }) ... }</p><p>We call the <a href="https://developer.apple.com/documentation/scriptingbridge/sbapplication"><code>SBApplication</code></a> constructor using the bundle identifier. If an object is returned, we cast as the <code>SafariApplication</code> protocol and get all the windows. The</p><p><code>windows</code> property only returns a <a href="https://developer.apple.com/documentation/scriptingbridge/sbelementarray"><code>SBElementArray</code></a>, so we need to cast those elements to a <code>SafariWindow</code>. From there we can get the window's set of tabs:</p><p>let safariWindow = safariWindows?.first let safariTab = safariWindow?.tabs?().firstObject as? SafariTab let url = safariTab?.URL</p><p>Let's break this down:</p><ol><li><code>let safariWindow = safariWindows?.first</code> - get the first Safari window</li><li><code>let safariTab = safariWindow?.tabs?().firstObject as? SafariTab</code> - get the first tab of the Safari window and cast it to SafariTab</li><li><code>let url = safariTab?.URL</code> - get the url of that particular tab</li></ol><p>If you need more details checkout <a href="https://github.com/brightdigit/jURLnal">the repo for the sample app</a> called <a href="https://github.com/brightdigit/jURLnal">jURLnal</a> which copies the URLs to the clipboard.</p><h4>Conclusion</h4><p>So as you can see -</p><ol><li>We have used the standard ScriptBridging tools to build the standard definition and Objective-C header file of Safari's AppleScript API.</li><li>We used <a href="https://github.com/tingraldi/SwiftScripting">a set of python scripts</a> from Tony Ingraldi of <a href="http://majestysoftware.com/">Majesty Software</a> to convert the Objective-C header file and standard definition to Swift code.</li><li>Added the two Swift files to our project and used the API to extract the windows and tabs of the currently open Safari application.</li></ol><p>If you have any questions, comments, or thoughts, be sure to post a comment below in <a href="https://brightdigit.com/blog/17/06/09/scriptingbridge-with-swift-communicating-with-apps-using-applescript-and-swift/#disqus_thread">the disqus forum</a>. If you are looking for a speaker on an Apple development topic or need help with your current macOS app project, feel free to <a href="https://brightdigit.com/#contact-us">contact me at our form here</a>.</p></div>
        <span>Tagged with: </span>
      </article>
    </main>
    <footer>
      <div class="address">5859 W Saginaw #182 Lansing MI 48917</div>
      <div class="copyright">Â© Bright Digit, LLC 2021</div>
    </footer>
  </body>
</html>