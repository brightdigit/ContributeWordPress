<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/css/styles.css"/>
  </head>
  <body>
    <header>
      <nav>
        <ol class="logo">
          <li>
            <a href="/">
              <img src="/media/brightdigit-name.svg"/>
            </a>
          </li>
        </ol>
        <ol class="menu">
          <li>
            <a href="/services">Services</a>
          </li>
          <li>
            <a href="/products">Products</a>
          </li>
          <li>
            <a href="/articles">Articles</a>
          </li>
          <li>
            <a href="/development">Development</a>
          </li>
        </ol>
        <ol class="menu">
          <li>
            <a href="/podcast">Podcast</a>
          </li>
          <li>
            <a href="/newsletters">Newsletters</a>
          </li>
          <li>
            <a href="/sponsorship">Sponsorship</a>
          </li>
          <li>
            <a href="/about">About</a>
          </li>
        </ol>
        <ol class="more">
          <li>
            <a href="/#menu">Menu</a>
          </li>
        </ol>
      </nav>
    </header>
    <main>
      <article>
        <div class="content"><p><strong>AppleScript </strong>is a great technology on macOS for both developers and power users. With <strong>AppleScript, </strong>users can create automated processes which work other apps. As a developer though, sometimes you want a <strong>build an app in Xcode with the power of AppleScript</strong> without the need to have separate script files. That's where ScriptingBridge comes in. To work with AppleScript in any app, there are two options to do this:</p><ol><li><strong>Write a separate AppleScript file </strong>and use the <a href="https://developer.apple.com/documentation/foundation/scripting_support"><em>NSAppleScript API</em></a> to execute and run the script.</li><li><strong>Use ScriptingBridge</strong> to work with AppleScript in <strong>Swift </strong>or <strong>Objective-C</strong>.</li></ol><p>We are going to look at the second option: ScriptingBridge. In particular, <strong>how to use ScriptingBridge in Swift</strong> without the need for AppleScript files or event Objective-C bridging.</p><h2>The Drawbacks of ScriptingBridge</h2><p><strong>If you intend to write an App for the Mac App Store there are restrictions as </strong><a href="https://developer.apple.com/library/content/qa/qa1888/_index.html"><strong>noted by Apple</strong></a><strong>.</strong> You can also look at <a href="https://www.objc.io/issues/14-mac/sandbox-scripting/">this article by Craig Hockenberry</a> which shows how you can use the AppleScript API in a Mac Store app. The bottom line is: <strong>You can not use ScriptingBridge with an app in the Mac App Store.</strong></p><h2>Objective-C ScriptingBridge to Swift ScriptingBridge</h2><p>When it comes to <strong>Objective-C ScriptingBridge</strong>, Apple already provides <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ScriptingBridgeConcepts/UsingScriptingBridge/UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_12">tools to prepare the code</a>. Luckily, <strong>Tony Ingraldi of </strong><a href="http://majestysoftware.com/"><strong>Majesty Software</strong></a><strong>, has </strong><a href="https://github.com/tingraldi/SwiftScripting"><strong>a great set of python scripts</strong></a><strong> for creating the same code in Swift.</strong> For more details on this specifically, take a look <a href="https://github.com/tingraldi/SwiftScripting">his repo on GitHub</a> or <a href="https://majestysoftware.wordpress.com/2015/03/31/swift-scripting-part-1/">his blog post here</a>.</p><h2>ScriptingBridge with Safari</h2><p>Now let's try doing this <strong>by writing </strong><a href="https://github.com/brightdigit/jURLnal"><strong>an app which pulls the tab urls out of a Safari window</strong></a><strong>. </strong>The repo for this app can be found <a href="https://github.com/brightdigit/jURLnal">here</a>. Building the Swift Code from AppleScript Definition Download the python scripting tools from the <a href="https://github.com/tingraldi/SwiftScripting">SwiftScripting repo on GitHub</a>. From the repo's directory, run the following commands:</p><pre><code>pip install clangsdef /<span class="type">Applications</span>/<span class="type">Safari</span>.<span class="property">app</span> &gt; <span class="type">Safari</span>.<span class="property">sdefsdp</span> -fh --basename <span class="type">Safari Safari</span>.<span class="property">sdef</span>./sbhc.<span class="property">py</span> <span class="type">Safari</span>.<span class="property">h</span>./sbsc.<span class="property">py</span> <span class="type">Safari</span>.<span class="property">sdef</span>
</code></pre><p>Let's break this down:</p><ol><li><code>pip install clang</code>- ensures clang is installed for python</li><li><code>sdef /Applications/Safari.app &gt; Safari.sdef</code>- gets the scripting definition from the specified scriptable application</li><li><code>sdp -fh --basename Safari Safari.sdef</code>- transforms a scripting definition to an Objective-C header file</li><li><code>./sbhc.py Safari.h</code>- transforms the Objective-C header file to Swift</li><li><code>./sbsc.py Safari.sdef</code>- extracts the enums from the standard definition to Swift</li></ol><p>Now you should have 4 new files:</p><ul><li><strong>Safari.sdef</strong> --- the scripting definition file</li><li><strong>Safari.h</strong> --- the objective-c header file, which we would use if we were doing objective-c directly or using objective-c bridging</li><li><strong>Safari.swift</strong> --- the primary file containing the main ScriptingBridge API to the application</li><li><strong>SafariScripting.swift</strong> --- the necessary enums needed by the ScriptingBridge API for the application</li></ul><p>Since we are using only Swift code, we will only need the two Swift files (Safari.swift and SafariScripting.swift) in our application. Add the two files to your project in Xcode and now in our application, we can talk to Safari.</p><h2>Using the ScriptingBridge API for Safari</h2><p>To pull the all Safari windows currently open:</p><pre><code><span class="keyword">if let</span> application = <span class="type">SBApplication</span>(bundleIdentifier: <span class="string">"com.apple.Safari"</span>) {  <span class="keyword">let</span> safariApplication = application <span class="keyword">as</span> <span class="type">SafariApplication</span>  <span class="keyword">let</span> safariWindows = safariApplication.<span class="property">windows</span>?().<span class="call">flatMap</span>({ $0 <span class="keyword">as</span>? <span class="type">SafariWindow</span> })  ...}
</code></pre><p>We call the <code>SBApplication</code>constructor using the bundle identifier. If an object is returned, we cast as the <code>SafariApplication</code>protocol and get all the windows. The <code>windows</code>property only returns a <code>SBElementArray</code>, so we need to cast those elements to a <code>SafariWindow</code>. Therefore by using the SafariWindow, we can get the window's set of tabs:</p><pre><code><span class="keyword">let</span> safariWindow = safariWindows?.<span class="property">firstlet</span> safariTab = safariWindow?.<span class="property">tabs</span>?().<span class="property">firstObject</span> <span class="keyword">as</span>? <span class="type">SafariTablet</span> url = safariTab?.<span class="type">URL</span>
</code></pre><p>So, let's break this down:</p><ol><li><code>let safariWindow = safariWindows?.first</code>- get the first Safari window</li><li><code>let safariTab = safariWindow?.tabs?().firstObject as? SafariTab</code>- grab the first tab of the Safari window and cast it to SafariTab</li><li><code>let url = safariTab?.URL</code>- get the url of that particular tab</li></ol><p>If you need more details, check out <a href="https://github.com/brightdigit/jURLnal">the repo for the sample app</a> called <a href="https://github.com/brightdigit/jURLnal">jURLnal</a> which copies the URLs to the clipboard.</p><h2>Conclusion</h2><p>So as you can see -</p><ol><li>We have used the standard ScriptingBridge tools to build the standard definition and Objective-C header file of Safari's AppleScript API.</li><li>By using <a href="https://github.com/tingraldi/SwiftScripting">a set of python scripts</a> from Tony Ingraldi of <a href="http://majestysoftware.com/">Majesty Software</a>, we can convert the Objective-C header file and standard definition to Swift code.</li><li>Adding the two Swift files to our project, we can use the API to extract the windows and tabs of the currently open Safari application.</li></ol><p>If you want to learn more about Swift and ScriptingBridge, sign up at the <a href="http://eepurl.com/dNQNAw">form here</a>.</p></div>
        <span>Tagged with: </span>
      </article>
    </main>
    <footer>
      <div class="address">5859 W Saginaw #182 Lansing MI 48917</div>
      <div class="copyright">© Bright Digit, LLC 2021</div>
    </footer>
  </body>
</html>